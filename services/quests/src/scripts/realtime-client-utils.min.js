// https://www.gstatic.com/realtime/realtime-client-utils.js
// Updated 8/2/17
window.utils={},utils.RealtimeUtils=function(e){this.init(e)},utils.RealtimeUtils.prototype={clientId:null,mimeType:"application/vnd.google-apps.drive-sdk",refreshInterval:18e5,scopes:["https://www.googleapis.com/auth/drive.install","https://www.googleapis.com/auth/drive.file"],init:function(e){this.mergeOptions(e),this.authorizer=new utils.RealtimeAuthorizer(this),this.createRealtimeFile=this.createRealtimeFile.bind(this)},authorize:function(e,t){this.authorizer.start(e,t)},mergeOptions:function(e){for(var t in e)this[t]=e[t]},getParam:function(e){var t=new RegExp(e+"=(.*?)($|&)","g"),i=window.location.search.match(t);return i=i&&i.length?(i=i[0]).replace(e+"=","").replace("&",""):null},createRealtimeFile:function(e,t){var i=this;window.gapi.client.load("drive","v2",function(){var o={resource:{mimeType:i.mimeType,title:e}};window.gapi.client.drive.files.insert(o).execute(t)})},load:function(e,t,i){window.gapi.drive.realtime.load(e,function(e){window.doc=e,t(e)},i,this.onError)},onError:function(e){e.type==window.gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED?this.authorizer.authorize(function(){console.log("Error, auth refreshed")},!1):e.type==window.gapi.drive.realtime.ErrorType.CLIENT_ERROR?(alert("An Error happened: "+e.message),window.location.href="/"):e.type==window.gapi.drive.realtime.ErrorType.NOT_FOUND?(alert("The file was not found. It does not exist or you do not have read access to the file."),window.location.href="/"):e.type==window.gapi.drive.realtime.ErrorType.FORBIDDEN&&(alert("You do not have access to this file. Try having the owner shareit with you from Google Drive."),window.location.href="/")}},utils.RealtimeAuthorizer=function(e){this.util=e,this.handleAuthResult=this.handleAuthResult.bind(this),this.token=null},utils.RealtimeAuthorizer.prototype={start:function(e,t){var i=this;window.gapi.load("auth:client,drive-realtime,drive-share",{callback:function(){i.authorize(e,t)}}),this.authTimer&&window.clearTimeout(this.authTimer),this.refreshAuth()},authorize:function(e,t){this.onAuthComplete=e,window.gapi.auth.authorize({client_id:this.util.clientId,scope:this.util.scopes,immediate:!t},this.handleAuthResult)},handleAuthResult:function(e){e&&!e.error&&(this.token=e.access_token),this.onAuthComplete(e)},refreshAuth:function(){var e=this;this.authTimer=setTimeout(function(){e.authorize(function(){console.log("Refreshed Auth Token")},!1),e.refreshAuth()},this.util.refreshInterval)}};
